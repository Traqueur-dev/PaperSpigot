From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: Aikar <aikar@aikar.co>
Date: Thu, 31 Mar 2016 19:17:58 -0400
Subject: [PATCH] Do not load chunks for Pathfinding


diff --git a/src/main/java/net/minecraft/world/level/pathfinder/WalkNodeEvaluator.java b/src/main/java/net/minecraft/world/level/pathfinder/WalkNodeEvaluator.java
index c68d227e758f11a3146fc382014ce96651cd7acf..5ff66dd2ff2e3027ee7f7b62d5398c965195d8ed 100644
--- a/src/main/java/net/minecraft/world/level/pathfinder/WalkNodeEvaluator.java
+++ b/src/main/java/net/minecraft/world/level/pathfinder/WalkNodeEvaluator.java
@@ -473,7 +473,12 @@ public class WalkNodeEvaluator extends NodeEvaluator {
                 for (int n = -1; n <= 1; n++) {
                     if (l != 0 || n != 0) {
                         pos.set(i + l, j + m, k + n);
-                        BlockState blockState = world.getBlockState(pos);
+                        // Paper start - Do not load chunks during pathfinding
+                        BlockState blockState = world.getBlockStateIfLoaded(pos);
+                        if (blockState == null) {
+                            return BlockPathTypes.BLOCKED;
+                        } else {
+                        // Paper end - Do not load chunks during pathfinding
                         if (blockState.is(Blocks.CACTUS) || blockState.is(Blocks.SWEET_BERRY_BUSH)) {
                             return BlockPathTypes.DANGER_OTHER;
                         }
@@ -489,6 +494,7 @@ public class WalkNodeEvaluator extends NodeEvaluator {
                         if (blockState.is(Blocks.WITHER_ROSE) || blockState.is(Blocks.POINTED_DRIPSTONE)) {
                             return BlockPathTypes.DAMAGE_CAUTIOUS;
                         }
+                        } // Paper
                     }
                 }
             }
@@ -498,7 +504,8 @@ public class WalkNodeEvaluator extends NodeEvaluator {
     }
 
     protected static BlockPathTypes getBlockPathTypeRaw(BlockGetter world, BlockPos pos) {
-        BlockState blockState = world.getBlockState(pos);
+        BlockState blockState = world.getBlockStateIfLoaded(pos); // Paper - Do not load chunks during pathfinding
+        if (blockState == null) return BlockPathTypes.BLOCKED; // Paper - Do not load chunks during pathfinding
         Block block = blockState.getBlock();
         if (blockState.isAir()) {
             return BlockPathTypes.OPEN;
